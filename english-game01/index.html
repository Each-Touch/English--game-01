<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‹±é›„å†’é™© - Mandy and Sandy</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Arial', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #FFF8F0 0%, #FFE4E1 100%);
      min-height: 100vh;
      overflow-x: hidden;
      /* ä¿®æ”¹ï¼šå¢åŠ é¡¶éƒ¨å†…è¾¹è·ï¼Œé˜²æ­¢å†…å®¹è¢«é¡¶éƒ¨Logoæ é®æŒ¡ */
      padding-top: 76px; 
      padding-bottom: 120px;
    }

    /* --- æ–°å¢ï¼šé¡¶éƒ¨ LOGO æ æ ·å¼ --- */
    .watermark-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 56px;
      z-index: 2000; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
      display: flex;
      align-items: center;
      /* èƒŒæ™¯æ”¹ä¸ºé»„è‰² */
      background-color: #FDD95A; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .watermark-content {
      width: 100%;
      display: flex;
      align-items: center;
      /* å†…å®¹å·¦å¯¹é½ */
      justify-content: flex-start; 
      padding: 0 20px;
    }

    /* Logo å›¾ç‰‡æ ·å¼ */
    .custom-logo-img {
      height: 36px; 
      width: auto;
      display: block;
      object-fit: contain;
    }
    /* ------------------------------ */

    .book-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      padding-bottom: 40px;
    }
    .title {
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 24px;
    }
    .game-container {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    .btn:active {
      transform: scale(0.95);
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }
    .btn-success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }
    .btn-warning {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      color: white;
    }
    .game-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .game-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(102, 126, 234, 0.3);
    }
    .card-word {
      font-size: 48px;
      font-weight: bold;
      color: white;
      margin-bottom: 16px;
    }
    .game-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 20px;
    }
    .option-btn {
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
      font-weight: bold;
    }
    .option-btn:hover {
      background: #f0f0f0;
      transform: translateY(-2px);
    }
    .option-btn.correct {
      background: #4ade80;
      color: white;
      border-color: #4ade80;
    }
    .option-btn.incorrect {
      background: #f87171;
      color: white;
      border-color: #f87171;
      animation: shake 0.5s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    @keyframes equipAnim {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
      100% { transform: scale(1) rotate(360deg); opacity: 1; }
    }
    @keyframes attackMove {
      0% { transform: translateX(0); opacity: 1; }
      100% { transform: translateX(100px); opacity: 0; }
    }
    @keyframes attackShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    @keyframes hurtShake {
      0%, 100% { transform: translateX(0); filter: brightness(1); }
      25% { transform: translateX(-15px); filter: brightness(1.5) hue-rotate(180deg); }
      75% { transform: translateX(15px); filter: brightness(1.5) hue-rotate(180deg); }
    }
    @keyframes fadeOut {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(2); }
    }
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .hidden {
      display: none !important;
    }
    .animation-toast {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      pointer-events: none;
      animation: slideInDown 0.5s ease, slideOutUp 0.5s ease 2.5s;
      animation-fill-mode: forwards;
    }
    @keyframes slideInDown {
      from {
        transform: translate(-50%, -100px);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    @keyframes slideOutUp {
      from {
        transform: translate(-50%, 0);
        opacity: 1;
      }
      to {
        transform: translate(-50%, -100px);
        opacity: 0;
      }
    }
    .encourage-toast {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      padding: 20px 40px;
      border-radius: 20px;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
      text-align: center;
    }
    .praise-toast {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 20px 40px;
      border-radius: 20px;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
      text-align: center;
    }
    .easter-egg-toast {
      background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
      color: white;
      padding: 24px 48px;
      border-radius: 24px;
      font-size: 28px;
      font-weight: bold;
      box-shadow: 0 15px 40px rgba(236, 72, 153, 0.5);
      text-align: center;
      animation: slideInDown 0.5s ease, pulse 0.5s ease 0.5s 3, slideOutUp 0.5s ease 3.5s;
    }
    .toast-icon {
      font-size: 48px;
      margin-bottom: 8px;
      display: block;
      animation: bounce 0.6s ease infinite;
    }
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #f0f;
      position: absolute;
      animation: confetti-fall 3s linear;
      pointer-events: none;
    }
    @keyframes confetti-fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    @media (max-width: 768px) {
      body {
        padding-bottom: 150px;
      }

      .book-container {
        padding: 12px;
        padding-bottom: 60px;
      }

      .title {
        font-size: 24px;
      }

      .hero-card {
        padding: 20px !important;
      }

      .hero-card img {
        width: 120px !important;
        height: 120px !important;
      }

      .hero-card h3 {
        font-size: 20px !important;
      }

      #heroImage, #battleHero, #bossHero {
        width: 100px !important;
        height: 100px !important;
      }

      #currentMonster, #bossImage {
        width: 100px !important;
        height: 100px !important;
      }

      .game-card {
        padding: 20px !important;
        min-height: 150px !important;
      }

      .card-word {
        font-size: 32px !important;
      }

      .option-btn {
        padding: 12px !important;
        font-size: 16px !important;
      }

      .unit-card {
        padding: 16px !important;
      }

      .unit-card > div:first-child {
        font-size: 36px !important;
      }

      .unit-card h3 {
        font-size: 20px !important;
      }

      [id^="slot-"] {
        min-height: 80px !important;
        padding: 8px !important;
      }

      [id^="equip-"] {
        width: 40px !important;
        height: 40px !important;
      }

      [id^="slot-"] > div:first-child {
        font-size: 10px !important;
      }

      .game-options {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <div class="watermark-overlay">
    <div class="watermark-content">
      <img src="LOGO.png" alt="Logo" class="custom-logo-img">
    </div>
  </div>

  <div class="book-container">
    <h1 class="title">âš”ï¸ è‹±é›„å†’é™© - å•è¯é—¯å…³</h1>

    <div id="genderSelection">
      <div class="game-container">
        <h2 style="text-align: center; margin-bottom: 24px; color: #667eea; font-size: 36px;">é€‰æ‹©ä½ çš„è‹±é›„</h2>
        <p style="text-align: center; font-size: 18px; color: #666; margin-bottom: 40px;">é€‰æ‹©ä½ çš„è‹±é›„æ€§åˆ«ï¼Œå¼€å§‹å²è¯—èˆ¬çš„å†’é™©æ—…ç¨‹ï¼</p>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; max-width: 800px; margin: 0 auto;">
          <div class="hero-card" data-gender="male" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 40px; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center;">
            <img src="https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/scYuyskJs6a2qZ7W357ywa.jpg" style="width: 200px; height: 200px; object-fit: contain; margin-bottom: 20px;">
            <h3 style="font-size: 28px; margin-bottom: 12px;">ğŸ—¡ï¸ è‹±å‹‡ç‹å­</h3>
            <p style="opacity: 0.9; font-size: 16px;">åŠ›é‡ä¸å‹‡æ°”çš„åŒ–èº«</p>
          </div>
          <div class="hero-card" data-gender="female" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 20px; padding: 40px; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center;">
            <img src="https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/SLfVxD9aUV2DSiXZjs2fTM.jpg" style="width: 200px; height: 200px; object-fit: contain; margin-bottom: 20px;">
            <h3 style="font-size: 28px; margin-bottom: 12px;">ğŸ¹ æ™ºæ…§å…¬ä¸»</h3>
            <p style="opacity: 0.9; font-size: 16px;">æ™ºæ…§ä¸æ•æ·çš„è±¡å¾</p>
          </div>
        </div>
      </div>
    </div>

    <div id="unitSelection" class="hidden">
      <div class="game-container">
        <h2 style="text-align: center; margin-bottom: 24px; color: #667eea;">ğŸ¯ å•è¯é—¯å…³ - é€‰æ‹©å•å…ƒ</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 24px;">
          <div class="unit-card" data-unit="1" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 24px; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“˜</div>
            <h3 style="font-size: 24px; margin-bottom: 8px;">Unit 1</h3>
            <p style="opacity: 0.9;">10ä¸ªå•è¯</p>
            <div style="margin-top: 12px; font-size: 14px; opacity: 0.8;">twin, they, long, blonde, of, height, usually, wear, same, dress</div>
          </div>
          <div class="unit-card" data-unit="2" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 16px; padding: 24px; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“—</div>
            <h3 style="font-size: 24px; margin-bottom: 8px;">Unit 2</h3>
            <p style="opacity: 0.9;">10ä¸ªå•è¯</p>
            <div style="margin-top: 12px; font-size: 14px; opacity: 0.8;">middle, class, PE, teacher, Mr, it, classmate, begin, surprised, say</div>
          </div>
          <div class="unit-card" data-unit="3" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 16px; padding: 24px; color: white; cursor: pointer; transition: all 0.3s ease; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“™</div>
            <h3 style="font-size: 24px; margin-bottom: 8px;">Unit 3</h3>
            <p style="opacity: 0.9;">9ä¸ªå•è¯</p>
            <div style="margin-top: 12px; font-size: 14px; opacity: 0.8;">you, do, again, also, this, understand, smile, may, mistake</div>
          </div>
        </div>
      </div>
    </div>

    <div id="unitLearning" class="hidden">
      <div class="game-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <button class="btn btn-secondary" id="backToUnitsBtn">â¬…ï¸ è¿”å›å•å…ƒé€‰æ‹©</button>
          <h2 style="color: #667eea; margin: 0;">Unit <span id="currentUnitNumber">1</span> - å•è¯é—¯å…³</h2>
          <div></div>
        </div>
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="font-size: 18px; font-weight: bold;">è¿›åº¦ <span id="unitProgressDisplay">0/30</span></span>
          <span style="margin-left: 24px; font-size: 18px;">â­ å¾—åˆ†: <span id="unitScore">0</span></span>
        </div>
        <div id="unitGameContent"></div>
      </div>
    </div>
  </div>

  <script>
    // å•è¯è¯å…¸
    const dictionary = {
      'twin': { phonetic: '[twÉªn]', translation: 'å åŒèƒèƒä¹‹ä¸€ï¼›å½¢ å­ªç”Ÿçš„ï¼›æˆå¯¹çš„' },
      'they': { phonetic: '[Ã°eÉª]', translation: 'ä»£ ä»–ï¼ˆå¥¹ã€å®ƒï¼‰ä»¬' },
      'long': { phonetic: '[lÉ’Å‹]', translation: 'å½¢ é•¿çš„ï¼›é•¿æ—¶é—´çš„' },
      'blonde': { phonetic: '[blÉ’nd]', translation: 'å½¢ é‡‘é»„è‰²çš„ï¼›å¤´å‘é‡‘é»„çš„' },
      'of': { phonetic: '[É™v; É’v]', translation: 'ä»‹ å±äºâ€¦â€¦çš„ï¼›ç”±â€¦â€¦ç»„æˆï¼›å…³äº' },
      'height': { phonetic: '[haÉªt]', translation: 'å é«˜ï¼Œé«˜åº¦ï¼›èº«é«˜' },
      'usually': { phonetic: '[ËˆjuËÊ’uÉ™li; ËˆjuËÊ’É™li]', translation: 'å‰¯ é€šå¸¸åœ°ï¼›æ­£å¸¸åœ°ï¼›ä¸€èˆ¬åœ°' },
      'wear': { phonetic: '[weÉ™(r)]', translation: 'åŠ¨ ç©¿ï¼›æˆ´' },
      'same': { phonetic: '[seÉªm]', translation: 'å½¢ ç›¸åŒçš„ï¼›åŒæ ·çš„' },
      'dress': { phonetic: '[dres]', translation: 'å è¿è¡£è£™ï¼›åŠ¨ ç©¿è¡£æœï¼›æ‰“æ‰®' },
      'middle': { phonetic: '[ËˆmÉªdl]', translation: 'å½¢ ä¸­é—´çš„ï¼›å ä¸­é—´' },
      'class': { phonetic: '[klÉ‘Ës]', translation: 'å è¯¾ï¼›ç­çº§' },
      'PE': { phonetic: '[ËŒpiË ËˆiË]', translation: 'å ä½“è‚²ï¼ˆè¯¾ï¼‰' },
      'teacher': { phonetic: '[ËˆtiËtÊƒÉ™(r)]', translation: 'å è€å¸ˆï¼Œæ•™å¸ˆ' },
      'Mr': { phonetic: '[ËˆmÉªstÉ™(r)]', translation: 'ç¼©ç•¥ å…ˆç”Ÿ' },
      'it': { phonetic: '[Éªt]', translation: 'ä»£ å®ƒ' },
      'classmate': { phonetic: '[ËˆklÉ‘ËsmeÉªt]', translation: 'å åŒç­åŒå­¦' },
      'begin': { phonetic: '[bÉªËˆÉ¡Éªn]', translation: 'åŠ¨ å¼€å§‹' },
      'surprised': { phonetic: '[sÉ™ËˆpraÉªzd]', translation: 'å½¢ æƒŠå¥‡çš„ï¼›æƒŠè®¶çš„' },
      'say': { phonetic: '[seÉª]', translation: 'åŠ¨ è¯´ï¼›æœ—è¯µï¼›è¡¨è¾¾' },
      'you': { phonetic: '[juË; ju]', translation: 'ä»£ ä½ ï¼Œä½ ä»¬' },
      'do': { phonetic: '[dÉ’; duË; du]', translation: 'åŠ¨ åš' },
      'again': { phonetic: '[É™ËˆÉ¡en; É™ËˆÉ¡eÉªn]', translation: 'å‰¯ åˆï¼Œå†ä¸€æ¬¡' },
      'also': { phonetic: '[ËˆÉ”ËlsÉ™ÊŠ]', translation: 'å‰¯ ä¹Ÿï¼›åŒæ ·' },
      'this': { phonetic: '[Ã°Éªs]', translation: 'é™å®šè¯/ä»£ è¿™ï¼Œè¿™ä¸ª' },
      'understand': { phonetic: '[ËŒÊŒndÉ™ËˆstÃ¦nd]', translation: 'åŠ¨ æ‡‚ï¼›ç†è§£' },
      'smile': { phonetic: '[smaÉªl]', translation: 'åŠ¨/å å¾®ç¬‘' },
      'may': { phonetic: '[meÉª]', translation: 'æƒ…æ€ å¯èƒ½ï¼›å¯ä»¥' },
      'mistake': { phonetic: '[mÉªËˆsteÉªk]', translation: 'å é”™è¯¯' }
    };

    // å•è¯åˆ†ç»„
    const wordUnits = {
      1: ['twin', 'they', 'long', 'blonde', 'of', 'height', 'usually', 'wear', 'same', 'dress'],
      2: ['middle', 'class', 'PE', 'teacher', 'Mr', 'it', 'classmate', 'begin', 'surprised', 'say'],
      3: ['you', 'do', 'again', 'also', 'this', 'understand', 'smile', 'may', 'mistake']
    };

    // å›¾ç‰‡èµ„æº
    const heroImages = {
      male: [
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/DCrHJhu2mPA5PRDDfaQjiF.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/8hCUmHE8aKXGpykJ6HETP2.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/4X8RBAJy6LN3Gdxh54UnE6.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/SB96E3VP6RJWuRfaUSuoTA.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/84N9686mUgniXioWRocPaS.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/gMsHa6pCTEkkqyq7hFE5SV.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/rJjDfQLFYW2QSZ3eSeu2RD.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/nPBPG8mg7YG7SR5mb5t73N.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/M2RA5LTswzRJoGR7mwhwx9.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/TnWjsZjgy8PSKndeKc6bf7.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/fT8wtgvshqNE4KkRAmz94m.jpg'
      ],
      female: [
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/3WhvzSzNtBk6F9ZY7wKd7R.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/L3aR6cPVcXU5SukyiqbFMZ.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/ChkAB6RmNv2HvT5Rhfq8wR.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/a8595vEDyfbCc7REfqZwPW.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/rPiJHwLfSRjPt3XCAySLve.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/JojnNdHEHmurtoRcAn7ouZ.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/K46YB3ibPBqoRz7ueVLGSi.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/2WpPRHRkfCXAK7YKPdQo92.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/gv3Pkqo8Mr25soB9Jccoob.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/ThkbWXr9iUKXsSrhYoSXCL.jpg',
        'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/9kZrcfQHwYckPbrLYQUARi.jpg'
      ]
    };

    const equipmentImages = {
      male: {
        helmet: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/UYrwxfg544a2ks7qi2YT2g.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/Vpe2XhxoqUiVnTLABVpnzQ.jpg'
        ],
        armor: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/vJKLUnEt2JtY9GEyiK5sVi.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/Rv7EjwS8jZ4yu83CHRxDuQ.jpg'
        ],
        gloves: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/MgmkdZ3YyR9gQmu2CsWFw9.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/HWLhDHjVEqW9xKiYYF58AY.jpg'
        ],
        weapon: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/KUJjJst6GPTAezb82idhBh.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/VGgHcoXNP5v6ymJ62uVheV.jpg'
        ],
        ring: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/dqLn3VBbNT9TtxEhnxvWBf.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/brk5j566rmQRLirsdJVpVY.jpg'
        ]
      },
      female: {
        helmet: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/V7b9fXvXFighMvQem8ZFmJ.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/ykgmFqec6gqKiTPhUuNqXi.jpg'
        ],
        armor: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/akWDUdCAf7KQkhW484kHs6.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/2PxA8Cd9ncB2VGEmd5cCpm.jpg'
        ],
        gloves: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/qGxmJh2MKECWjDPmVxgVDb.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/txjYSAS8SnKiSyEyxaCLog.jpg'
        ],
        weapon: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/JLkP3JHCEHPcciRbM7RRJ7.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/4a8td3G6NuuLqWWCDC4Z3T.jpg'
        ],
        ring: [
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/Z6U7p4csF4VBdySXNSyaiD.jpg',
          'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/W5jeyg3MspgCZZtEyEDcTQ.jpg'
        ]
      }
    };

    const monsterImages = [
      'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/dknNjnJu4SBngwZGmafWRj.jpg',
      'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/Utzeyq7ZaVLRKqgLZdVsE3.jpg',
      'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/A82syZqg75jKkj9RbdQaGk.jpg',
      'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/VqYkEPmihu54y4EjJKmyK5.jpg',
      'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/TWdmS5rajGM7Wv3wLoHA2P.jpg',
      'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/cpaRGWiGnxTLdwjMPqzfiY.jpg'
    ];

    const bossImage = 'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/eJh8wyG4SjNDgu5XWDLeDg.jpg';
    const upgradeEffect = 'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/XdG3BVGbYg8uoYqPUcNKVC.jpg';
    const attackEffect = 'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/CQ2JUpR56cgVx74oHrx4QT.jpg';
    const defenseEffect = 'https://musk-online.fbcontent.cn/pub-musk-ai-studio/workflow/file/picture/fLtDg3uyLGE6mpm2ssgSTM.jpg';

    // æ¸¸æˆçŠ¶æ€
    let heroGender = '';
    let currentUnit = 1;
    let unitWords = [];
    let unitWrongWords = [];
    let unitProgress = 0;
    let gameScore = 0;
    let heroLevel = 1;
    let heroEquipment = { helmet: 0, armor: 0, gloves: 0, weapon: 0, ring: 0 };
    let equipmentOrder = ['helmet', 'armor', 'gloves', 'weapon', 'ring'];
    let currentEquipIndex = 0;
    let monstersDefeated = 0;
    let usedMonsters = [];
    let bossHP = 10;
    let heroHP = 10;
    let correctAnswers = 0;
    let totalQuestions = 0;
    let usedEncouragements = [];
    let usedPraises = [];
    let usedEasterEggs = [];
    let hasShownFirstEnding = false;
    let reviewIndex = 0;

    // é¼“åŠ±è¯­åº“
    const encouragements = [
      { icon: 'âš”ï¸', text: 'å‹‡å£«ä¸ä¼šè¢«å›°éš¾å‡»å€’ï¼å†æ¥ä¸€æ¬¡ï¼' },
      { icon: 'ğŸ›¡ï¸', text: 'å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯ï¼Œç»§ç»­æˆ˜æ–—ï¼' },
      { icon: 'ğŸ’ª', text: 'çœŸæ­£çš„è‹±é›„ä»ä¸æ”¾å¼ƒï¼' },
      { icon: 'ğŸŒŸ', text: 'æ¯ä¸€æ¬¡æŒ‘æˆ˜éƒ½è®©ä½ æ›´å¼ºå¤§ï¼' },
      { icon: 'ğŸ”¥', text: 'ç‡ƒèµ·ä½ çš„æ–—å¿—ï¼Œå†æˆ˜ä¸€å›ï¼' }
    ];

    const praises = [
      { icon: 'âš”ï¸', text: 'å®Œç¾ä¸€å‡»ï¼è‹±é›„çš„åŠ›é‡è§‰é†’äº†ï¼' },
      { icon: 'ğŸ†', text: 'å‡ºè‰²çš„æˆ˜æ–—ï¼ä½ æ˜¯çœŸæ­£çš„å‹‡å£«ï¼' },
      { icon: 'âœ¨', text: 'é­”æ³•èˆ¬çš„è¡¨ç°ï¼ç»§ç»­å‰è¿›ï¼' },
      { icon: 'ğŸŒŸ', text: 'å…‰èŠ’å››å°„ï¼ä½ çš„å®åŠ›ä»¤äººæƒŠå¹ï¼' },
      { icon: 'ğŸ¯', text: 'ç²¾å‡†æ‰“å‡»ï¼é­”ç‰©æ— å¤„å¯é€ƒï¼' }
    ];

    const easterEggs = [
      { icon: 'ğŸ‘‘', text: 'ä¼ å¥‡è¯ç”Ÿï¼ä½ å·²æˆä¸ºçœŸæ­£çš„è‹±é›„ï¼' },
      { icon: 'ğŸ†', text: 'ç¥è¯çº§è¡¨ç°ï¼è¿æš—å½±é­”é¾™éƒ½ä¸ºä¹‹é¢¤æŠ–ï¼' },
      { icon: 'âš”ï¸', text: 'æ— æ•Œæˆ˜ç¥ï¼ä½ çš„åå­—å°†è¢«æ°¸è¿œé“­è®°ï¼' }
    ];

    // åˆå§‹åŒ–
    function init() {
      document.querySelectorAll('.hero-card').forEach(card => {
        card.addEventListener('click', () => {
          heroGender = card.dataset.gender;
          document.getElementById('genderSelection').classList.add('hidden');
          showUnitSelection();
        });

        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-12px) scale(1.05)';
          this.style.boxShadow = '0 20px 40px rgba(0,0,0,0.3)';
        });

        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
          this.style.boxShadow = 'none';
        });
      });
    }

    function showUnitSelection() {
      document.getElementById('unitSelection').classList.remove('hidden');
      document.getElementById('unitLearning').classList.add('hidden');

      document.querySelectorAll('.unit-card').forEach(card => {
        card.addEventListener('click', () => {
          const unit = parseInt(card.dataset.unit);
          startUnitLearning(unit);
        });

        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-8px)';
          this.style.boxShadow = '0 12px 24px rgba(0,0,0,0.2)';
        });

        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = 'none';
        });
      });
    }

    function startUnitLearning(unit) {
      currentUnit = unit;
      unitProgress = 0;
      gameScore = 0;
      unitWrongWords = [];
      heroLevel = 1;
      heroEquipment = { helmet: 0, armor: 0, gloves: 0, weapon: 0, ring: 0 };
      currentEquipIndex = 0;
      monstersDefeated = 0;
      usedMonsters = [];
      bossHP = 10;
      heroHP = 10;
      correctAnswers = 0;
      totalQuestions = 0;
      hasShownFirstEnding = false;

      unitWords = wordUnits[unit].map(word => ({
        word: word,
        translation: dictionary[word].translation,
        phonetic: dictionary[word].phonetic
      }));

      document.getElementById('unitSelection').classList.add('hidden');
      document.getElementById('unitLearning').classList.remove('hidden');
      document.getElementById('currentUnitNumber').textContent = unit;

      updateUnitDisplay();
      startEquipmentPhase();
    }

    function updateUnitDisplay() {
      const totalTasks = unitWords.length * 3;
      document.getElementById('unitProgressDisplay').textContent = `${unitProgress}/${totalTasks}`;
      document.getElementById('unitScore').textContent = gameScore;
    }

    function getHeroImage() {
      const slots = ['helmet', 'armor', 'gloves', 'weapon', 'ring'];
      let equippedCount = 0;
      let upgradedCount = 0;

      for (const slot of slots) {
        if (heroEquipment[slot] >= 1) {
          equippedCount++;
          if (heroEquipment[slot] >= 2) {
            upgradedCount++;
          }
        }
      }

      if (equippedCount === 0) {
        return heroImages[heroGender][0];
      } else if (equippedCount <= 5 && upgradedCount === 0) {
        return heroImages[heroGender][equippedCount];
      } else {
        return heroImages[heroGender][5 + upgradedCount];
      }
    }

    function updateHeroImage() {
      const heroImg = document.getElementById('heroImage');
      if (heroImg) {
        heroImg.src = getHeroImage();
      }
    }

    function getEquipmentName(slot) {
      const names = {
        helmet: 'å¤´ç›”',
        armor: 'æŠ¤ç”²',
        gloves: 'æ‰‹å¥—',
        weapon: heroGender === 'female' ? 'é­”æ³•æ–' : 'æ­¦å™¨',
        ring: 'æˆ’æŒ‡'
      };
      return names[slot];
    }

    // ç¬¬ä¸€é˜¶æ®µï¼šè£…å¤‡é˜¶æ®µ
    function startEquipmentPhase() {
      if (unitProgress >= unitWords.length) {
        startBattlePhase();
        return;
      }

      const word = unitWords[unitProgress];
      const wrongOptions = unitWords.filter(w => w.word !== word.word)
        .sort(() => Math.random() - 0.5)
        .slice(0, 3);

      const options = [word, ...wrongOptions].sort(() => Math.random() - 0.5);

      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 24px; align-items: start;">
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 24px; color: white;">
            <h3 style="text-align: center; margin-bottom: 16px; font-size: 20px;">âš”ï¸ è£…å¤‡è‹±é›„</h3>
            <div style="text-align: center; margin-bottom: 20px;">
              <img id="heroImage" src="${getHeroImage()}" style="width: 150px; height: 150px; object-fit: contain;">
              <div style="margin-top: 12px; font-size: 18px; font-weight: bold;">ç­‰çº§ ${heroLevel}</div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
              ${equipmentOrder.map(slot => `
                <div id="slot-${slot}" style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px; text-align: center; min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                  <div style="font-size: 12px; margin-bottom: 8px; opacity: 0.8;">${getEquipmentName(slot)}</div>
                  <div id="equip-${slot}" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                    ${heroEquipment[slot] > 0 ? `<img src="${equipmentImages[heroGender][slot][heroEquipment[slot]-1]}" style="width: 100%; height: 100%; object-fit: contain;">` : '<div style="font-size: 32px; opacity: 0.3;">â“</div>'}
                  </div>
                  ${heroEquipment[slot] > 0 ? `<div style="font-size: 11px; margin-top: 4px; color: #fbbf24;">+${heroEquipment[slot]}</div>` : ''}
                </div>
              `).join('')}
            </div>
          </div>
          <div>
            <div style="text-align: center; margin-bottom: 16px;">
              <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 20px; font-weight: bold; font-size: 13px; white-space: nowrap; display: inline-block;">å®Œæˆä»»åŠ¡è·å¾—è£…å¤‡</span>
            </div>
            <div class="game-card">
              <div class="card-word">${word.word}</div>
              <div style="color: white; font-size: 18px; margin-top: 16px;">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡æ„æ€</div>
            </div>
            <div class="game-options">
              ${options.map(opt => `
                <button class="option-btn" data-answer="${opt.word === word.word}" data-word="${word.word}">
                  ${opt.translation}
                </button>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', () => handleEquipmentAnswer(btn, word.word));
      });
    }

    function handleEquipmentAnswer(btn, correctWord) {
      const isCorrect = btn.dataset.answer === 'true';
      totalQuestions++;

      document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

      if (isCorrect) {
        btn.classList.add('correct');
        correctAnswers++;
        gameScore += 10;

        if (currentEquipIndex < 5) {
          const slot = equipmentOrder[currentEquipIndex];
          heroEquipment[slot] = 1;
          heroLevel++;
          currentEquipIndex++;
          showEquipAnimation(slot);
        } else {
          const slot = equipmentOrder[Math.floor(Math.random() * 5)];
          if (heroEquipment[slot] < 2) {
            heroEquipment[slot] = 2;
            heroLevel++;
            showUpgradeAnimation(slot);
          } else {
            heroLevel++;
            showLevelUpAnimation();
          }
        }

        updateUnitDisplay();
        updateHeroImage();
        showPraise();

        setTimeout(() => {
          unitProgress++;
          startEquipmentPhase();
        }, 2000);
      } else {
        btn.classList.add('incorrect');
        showEncouragement();

        unitWrongWords.push({ word: correctWord, mode: 'equipment' });

        setTimeout(() => {
          document.querySelectorAll('.option-btn').forEach(b => {
            if (b.dataset.answer === 'true') {
              b.classList.add('correct');
              b.style.cursor = 'pointer';
              b.disabled = false;
              b.onclick = () => {
                unitProgress++;
                updateUnitDisplay();
                startEquipmentPhase();
              };
            }
          });
        }, 500);
      }
    }

    function showEquipAnimation(slot) {
      playEquipSound();

      const slotDiv = document.getElementById(`equip-${slot}`);
      const img = document.createElement('img');
      img.src = equipmentImages[heroGender][slot][0];
      img.style.cssText = 'width: 100%; height: 100%; object-fit: contain; animation: equipAnim 1s ease;';
      slotDiv.innerHTML = '';
      slotDiv.appendChild(img);

      const effect = document.createElement('div');
      effect.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;';
      effect.innerHTML = `<img src="${upgradeEffect}" style="width: 100px; height: 100px; animation: fadeOut 1s ease;">`;
      document.getElementById(`slot-${slot}`).style.position = 'relative';
      document.getElementById(`slot-${slot}`).appendChild(effect);
      setTimeout(() => effect.remove(), 1000);
    }

    function showUpgradeAnimation(slot) {
      playUpgradeSound();

      const slotDiv = document.getElementById(`equip-${slot}`);
      const img = document.createElement('img');
      img.src = equipmentImages[heroGender][slot][1];
      img.style.cssText = 'width: 100%; height: 100%; object-fit: contain; animation: equipAnim 1s ease;';
      slotDiv.innerHTML = '';
      slotDiv.appendChild(img);

      const effect = document.createElement('div');
      effect.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none;';
      effect.innerHTML = `<img src="${upgradeEffect}" style="width: 100px; height: 100px; animation: fadeOut 1s ease;">`;
      document.getElementById(`slot-${slot}`).style.position = 'relative';
      document.getElementById(`slot-${slot}`).appendChild(effect);
      setTimeout(() => effect.remove(), 1000);
    }

    function showLevelUpAnimation() {
      const heroImg = document.getElementById('heroImage');
      heroImg.style.animation = 'bounce 0.5s ease';
      setTimeout(() => heroImg.style.animation = '', 500);
    }

    // ç¬¬äºŒé˜¶æ®µï¼šæˆ˜æ–—é˜¶æ®µ
    function startBattlePhase() {
      if (unitProgress >= unitWords.length * 2) {
        startBossPhase();
        return;
      }

      const wordIndex = unitProgress - unitWords.length;
      const word = unitWords[wordIndex];
      const wrongOptions = unitWords.filter(w => w.word !== word.word)
        .sort(() => Math.random() - 0.5)
        .slice(0, 3);

      const options = [word, ...wrongOptions].sort(() => Math.random() - 0.5);

      let availableMonsters = monsterImages.filter(m => !usedMonsters.includes(m));
      if (availableMonsters.length === 0) {
        availableMonsters = [...monsterImages];
        usedMonsters = [];
      }
      const currentMonster = availableMonsters[Math.floor(Math.random() * availableMonsters.length)];
      usedMonsters.push(currentMonster);

      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">âš”ï¸ æ–©æ€é­”ç‰© - å¬éŸ³é€‰è¯</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 24px;">
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 12px;">ğŸ¦¸ è‹±é›„ (Lv.${heroLevel})</div>
            <div id="heroContainer" style="position: relative; display: inline-block;">
              <img id="battleHero" src="${getHeroImage()}" style="width: 150px; height: 150px; object-fit: contain;">
            </div>
            <div style="margin-top: 12px; font-size: 16px; color: #10b981;">å·²å‡»è´¥: ${monstersDefeated} åªé­”ç‰©</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: bold; color: #ef4444; margin-bottom: 12px;">ğŸ‘¹ é­”ç‰©</div>
            <div id="monsterContainer" style="position: relative; display: inline-block;">
              <img id="currentMonster" src="${currentMonster}" style="width: 150px; height: 150px; object-fit: contain;">
            </div>
          </div>
        </div>
        <div class="game-card" style="cursor: pointer; margin-bottom: 24px;" onclick="speakWord('${word.word}')">
          <div style="font-size: 64px; margin-bottom: 16px;">ğŸ”Š</div>
          <div style="color: white; font-size: 18px;">ç‚¹å‡»å¬å•è¯å‘éŸ³</div>
        </div>
        <div class="game-options">
          ${options.map(opt => `
            <button class="option-btn" data-answer="${opt.word === word.word}" data-word="${word.word}">
              ${opt.word}
            </button>
          `).join('')}
        </div>
      `;

      setTimeout(() => speakWord(word.word), 500);

      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', () => handleBattleAnswer(btn, word.word));
      });
    }

    function handleBattleAnswer(btn, correctWord) {
      const isCorrect = btn.dataset.answer === 'true';
      totalQuestions++;

      document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

      if (isCorrect) {
        btn.classList.add('correct');
        correctAnswers++;
        gameScore += 10;
        monstersDefeated++;

        showAttackAnimation('hero');
        showPraise();

        setTimeout(() => {
          playVictorySound();
          const monster = document.getElementById('currentMonster');
          monster.style.animation = 'fadeOut 0.5s ease';

          setTimeout(() => {
            unitProgress++;
            updateUnitDisplay();
            startBattlePhase();
          }, 500);
        }, 1500);
      } else {
        btn.classList.add('incorrect');
        showEncouragement();

        showAttackAnimation('monster');

        unitWrongWords.push({ word: correctWord, mode: 'battle' });

        setTimeout(() => {
          document.querySelectorAll('.option-btn').forEach(b => {
            if (b.dataset.answer === 'true') {
              b.classList.add('correct');
              b.style.cursor = 'pointer';
              b.disabled = false;
              b.onclick = () => {
                unitProgress++;
                updateUnitDisplay();
                startBattlePhase();
              };
            }
          });
        }, 1500);
      }
    }

    function showAttackAnimation(attacker) {
      if (attacker === 'hero') {
        playAttackSound();

        const heroContainer = document.getElementById('heroContainer');

        const effect = document.createElement('div');
        effect.style.cssText = 'position: absolute; top: 50%; left: 100%; transform: translate(-50%, -50%); z-index: 10;';
        effect.innerHTML = `<img src="${attackEffect}" style="width: 80px; height: 80px; animation: attackMove 1s ease;">`;
        heroContainer.appendChild(effect);
        setTimeout(() => effect.remove(), 1000);

        const hero = document.getElementById('battleHero');
        hero.style.animation = 'attackShake 0.5s ease';
        setTimeout(() => hero.style.animation = '', 500);

        setTimeout(() => {
          playHitSound();
          const monster = document.getElementById('currentMonster');
          if (monster) {
            monster.style.animation = 'hurtShake 0.5s ease';
            monster.style.filter = 'brightness(2) hue-rotate(180deg)';
            setTimeout(() => {
              monster.style.animation = '';
              monster.style.filter = '';
            }, 500);
          }
        }, 500);
      } else {
        playAttackSound();

        const monsterContainer = document.getElementById('monsterContainer');

        const effect = document.createElement('div');
        effect.style.cssText = 'position: absolute; top: 50%; right: 100%; transform: translate(50%, -50%); z-index: 10;';
        effect.innerHTML = `<img src="${attackEffect}" style="width: 80px; height: 80px; animation: attackMove 1s ease;">`;
        monsterContainer.appendChild(effect);
        setTimeout(() => effect.remove(), 1000);

        setTimeout(() => {
          playHitSound();
          const hero = document.getElementById('battleHero');
          if (hero) {
            hero.style.animation = 'hurtShake 0.5s ease';
            hero.style.filter = 'brightness(2) hue-rotate(180deg)';
            setTimeout(() => {
              hero.style.animation = '';
              hero.style.filter = '';
            }, 500);
          }
        }, 500);
      }
    }

    // ç¬¬ä¸‰é˜¶æ®µï¼šBOSSæˆ˜
    function startBossPhase() {
      if (unitProgress >= unitWords.length * 3) {
        if (unitWrongWords.length > 0) {
          reviewWrongWords();
        } else {
          calculateResult();
        }
        return;
      }

      const wordIndex = unitProgress - unitWords.length * 2;
      const word = unitWords[wordIndex];

      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">ğŸ‰ ç»ˆæBOSSæˆ˜ - æ‹¼å†™æŒ‘æˆ˜</span>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 24px;">
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 12px;">ğŸ¦¸ è‹±é›„ (Lv.${heroLevel})</div>
            <div id="heroContainerBoss" style="position: relative; display: inline-block;">
              <img id="bossHero" src="${getHeroImage()}" style="width: 150px; height: 150px; object-fit: contain;">
            </div>
            <div style="margin-top: 12px;">
              <div style="background: #10b981; height: 20px; border-radius: 10px; overflow: hidden; position: relative;">
                <div id="heroHPBar" style="background: #34d399; height: 100%; width: ${(heroHP / 10) * 100}%; transition: width 0.3s ease;"></div>
              </div>
              <div style="font-size: 14px; margin-top: 4px; color: #10b981;">HP: ${heroHP}/10</div>
            </div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 18px; font-weight: bold; color: #ef4444; margin-bottom: 12px;">ğŸ‰ æš—å½±é¾™ç‹</div>
            <div id="bossContainer" style="position: relative; display: inline-block;">
              <img id="bossImage" src="${bossImage}" style="width: 200px; height: 200px; object-fit: contain;">
            </div>
            <div style="margin-top: 12px;">
              <div style="background: #ef4444; height: 20px; border-radius: 10px; overflow: hidden; position: relative;">
                <div id="bossHPBar" style="background: #f87171; height: 100%; width: ${(bossHP / 10) * 100}%; transition: width 0.3s ease;"></div>
              </div>
              <div style="font-size: 14px; margin-top: 4px; color: #ef4444;">HP: ${bossHP}/10</div>
            </div>
          </div>
        </div>
        <div class="game-card">
          <div style="color: white; font-size: 24px; margin-bottom: 16px;">${word.translation}</div>
          <div style="color: white; font-size: 18px; margin-bottom: 24px;">${word.phonetic}</div>
          <input type="text" id="bossSpellInput" placeholder="è¾“å…¥è‹±æ–‡å•è¯" 
            style="padding: 16px; font-size: 20px; border-radius: 12px; border: none; width: 80%; text-align: center;">
        </div>
        <div style="text-align: center; margin-top: 24px;">
          <button class="btn btn-success" onclick="checkBossSpelling('${word.word}')">âš”ï¸ æ”»å‡»BOSS</button>
          <button class="btn btn-secondary" onclick="speakWord('${word.word}')">ğŸ”Š å¬å‘éŸ³</button>
        </div>
      `;

      document.getElementById('bossSpellInput').focus();
      document.getElementById('bossSpellInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          checkBossSpelling(word.word);
        }
      });
    }

    window.checkBossSpelling = function(correctWord) {
      const input = document.getElementById('bossSpellInput').value.trim().toLowerCase();
      const isCorrect = input === correctWord.toLowerCase();
      totalQuestions++;

      if (isCorrect) {
        correctAnswers++;
        gameScore += 10;
        bossHP--;

        showBossAttackAnimation('hero');
        showPraise();

        document.getElementById('bossHPBar').style.width = `${(bossHP / 10) * 100}%`;
        document.getElementById('bossHPBar').parentElement.nextElementSibling.textContent = `HP: ${bossHP}/10`;

        setTimeout(() => {
          unitProgress++;
          updateUnitDisplay();
          startBossPhase();
        }, 2000);
      } else {
        showEncouragement();
        heroHP--;

        showBossAttackAnimation('boss');

        unitWrongWords.push({ word: correctWord, mode: 'boss' });

        document.getElementById('heroHPBar').style.width = `${(heroHP / 10) * 100}%`;
        document.getElementById('heroHPBar').parentElement.nextElementSibling.textContent = `HP: ${heroHP}/10`;

        const gameContent = document.getElementById('unitGameContent');
        const correctAnswerDiv = document.createElement('div');
        correctAnswerDiv.style.cssText = 'text-align: center; margin-top: 16px; padding: 16px; background: #4ade80; color: white; border-radius: 12px; cursor: pointer; font-size: 20px; font-weight: bold;';
        correctAnswerDiv.textContent = `æ­£ç¡®ç­”æ¡ˆï¼š${correctWord}`;
        correctAnswerDiv.onclick = () => {
          unitProgress++;
          updateUnitDisplay();
          startBossPhase();
        };
        gameContent.appendChild(correctAnswerDiv);

        document.getElementById('bossSpellInput').disabled = true;
        document.getElementById('bossSpellInput').style.border = '3px solid #f87171';
      }
    };

    function showBossAttackAnimation(attacker) {
      if (attacker === 'hero') {
        playAttackSound();

        const heroContainer = document.getElementById('heroContainerBoss');

        const effect = document.createElement('div');
        effect.style.cssText = 'position: absolute; top: 50%; left: 100%; transform: translate(-50%, -50%); z-index: 10;';
        effect.innerHTML = `<img src="${attackEffect}" style="width: 100px; height: 100px; animation: attackMove 1s ease;">`;
        heroContainer.appendChild(effect);
        setTimeout(() => effect.remove(), 1000);

        const hero = document.getElementById('bossHero');
        hero.style.animation = 'attackShake 0.5s ease';
        setTimeout(() => hero.style.animation = '', 500);

        setTimeout(() => {
          playHitSound();
          const boss = document.getElementById('bossImage');
          if (boss) {
            boss.style.animation = 'hurtShake 0.5s ease';
            boss.style.filter = 'brightness(2) hue-rotate(180deg)';
            setTimeout(() => {
              boss.style.animation = '';
              boss.style.filter = '';
            }, 500);
          }
        }, 500);
      } else {
        playAttackSound();

        const bossContainer = document.getElementById('bossContainer');

        const effect = document.createElement('div');
        effect.style.cssText = 'position: absolute; top: 50%; right: 100%; transform: translate(50%, -50%); z-index: 10;';
        effect.innerHTML = `<img src="${defenseEffect}" style="width: 120px; height: 120px; animation: attackMove 1s ease;">`;
        bossContainer.appendChild(effect);
        setTimeout(() => effect.remove(), 1000);

        const boss = document.getElementById('bossImage');
        boss.style.animation = 'attackShake 0.5s ease';
        boss.style.filter = 'brightness(1.5) drop-shadow(0 0 20px red)';
        setTimeout(() => {
          boss.style.animation = '';
          boss.style.filter = '';
        }, 500);

        setTimeout(() => {
          playHitSound();
          const hero = document.getElementById('bossHero');
          if (hero) {
            hero.style.animation = 'hurtShake 0.5s ease';
            hero.style.filter = 'brightness(2) hue-rotate(180deg)';
            setTimeout(() => {
              hero.style.animation = '';
              hero.style.filter = '';
            }, 500);
          }
        }, 500);
      }
    }

    // é”™é¢˜å¤ä¹ 
    function reviewWrongWords() {
      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <h2 style="font-size: 32px; color: #667eea; margin-bottom: 24px;">ğŸ“ é”™é¢˜å¤ä¹ </h2>
          <p style="font-size: 18px; margin-bottom: 24px;">ä½ æœ‰ ${unitWrongWords.length} é“é¢˜ç­”é”™äº†ï¼Œè®©æˆ‘ä»¬é‡æ–°ç»ƒä¹ ä¸€ä¸‹ï¼</p>
          <button class="btn btn-success" onclick="startReview()">ğŸ”„ å¼€å§‹å¤ä¹ </button>
        </div>
      `;
    }

    window.startReview = function() {
      reviewIndex = 0;
      continueReview();
    };

    function continueReview() {
      if (reviewIndex >= unitWrongWords.length) {
        calculateResult();
        return;
      }

      const wrongItem = unitWrongWords[reviewIndex];
      const word = unitWords.find(w => w.word === wrongItem.word);

      if (wrongItem.mode === 'equipment') {
        reviewMode1(word);
      } else if (wrongItem.mode === 'battle') {
        reviewMode2(word);
      } else if (wrongItem.mode === 'boss') {
        reviewMode3(word);
      }
    }

    function reviewMode1(word) {
      const wrongOptions = unitWords.filter(w => w.word !== word.word)
        .sort(() => Math.random() - 0.5)
        .slice(0, 3);

      const options = [word, ...wrongOptions].sort(() => Math.random() - 0.5);

      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">ğŸ”¥ æ¶ˆé™¤é»‘æš—ç¢ç‰‡ ${reviewIndex + 1}/${unitWrongWords.length}</span>
        </div>
        <div class="game-card">
          <div class="card-word">${word.word}</div>
          <div style="color: white; font-size: 18px; margin-top: 16px;">é€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡æ„æ€</div>
        </div>
        <div class="game-options">
          ${options.map(opt => `
            <button class="option-btn" data-answer="${opt.word === word.word}" data-word="${word.word}">
              ${opt.translation}
            </button>
          `).join('')}
        </div>
      `;

      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', () => handleReviewAnswer(btn, word.word));
      });
    }

    function reviewMode2(word) {
      const wrongOptions = unitWords.filter(w => w.word !== word.word)
        .sort(() => Math.random() - 0.5)
        .slice(0, 3);

      const options = [word, ...wrongOptions].sort(() => Math.random() - 0.5);

      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">ğŸ”¥ æ¶ˆé™¤é»‘æš—ç¢ç‰‡ ${reviewIndex + 1}/${unitWrongWords.length}</span>
        </div>
        <div class="game-card" style="cursor: pointer;" onclick="speakWord('${word.word}')">
          <div style="font-size: 64px; margin-bottom: 16px;">ğŸ”Š</div>
          <div style="color: white; font-size: 18px;">ç‚¹å‡»å¬å•è¯å‘éŸ³</div>
        </div>
        <div class="game-options">
          ${options.map(opt => `
            <button class="option-btn" data-answer="${opt.word === word.word}" data-word="${word.word}">
              ${opt.word}
            </button>
          `).join('')}
        </div>
      `;

      setTimeout(() => speakWord(word.word), 500);

      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', () => handleReviewAnswer(btn, word.word));
      });
    }

    function reviewMode3(word) {
      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; margin-bottom: 16px;">
          <span style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">ğŸ”¥ æ¶ˆé™¤é»‘æš—ç¢ç‰‡ ${reviewIndex + 1}/${unitWrongWords.length}</span>
        </div>
        <div class="game-card">
          <div style="color: white; font-size: 24px; margin-bottom: 16px;">${word.translation}</div>
          <div style="color: white; font-size: 18px; margin-bottom: 24px;">${word.phonetic}</div>
          <input type="text" id="reviewSpellInput" placeholder="è¾“å…¥è‹±æ–‡å•è¯" 
            style="padding: 16px; font-size: 20px; border-radius: 12px; border: none; width: 80%; text-align: center;">
        </div>
        <div style="text-align: center; margin-top: 24px;">
          <button class="btn btn-success" onclick="checkReviewSpelling('${word.word}')">âš”ï¸ æäº¤ç­”æ¡ˆ</button>
          <button class="btn btn-secondary" onclick="speakWord('${word.word}')">ğŸ”Š å¬å‘éŸ³</button>
        </div>
      `;

      document.getElementById('reviewSpellInput').focus();
      document.getElementById('reviewSpellInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          checkReviewSpelling(word.word);
        }
      });
    }

    function handleReviewAnswer(btn, correctWord) {
      const isCorrect = btn.dataset.answer === 'true';

      document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

      if (isCorrect) {
        btn.classList.add('correct');
        showPraise();

        reviewIndex++;

        setTimeout(() => {
          continueReview();
        }, 1500);
      } else {
        btn.classList.add('incorrect');
        showEncouragement();

        setTimeout(() => {
          document.querySelectorAll('.option-btn').forEach(b => {
            if (b.dataset.answer === 'true') {
              b.classList.add('correct');
              b.style.cursor = 'pointer';
              b.disabled = false;
              b.onclick = () => {
                reviewIndex++;
                continueReview();
              };
            }
          });
        }, 500);
      }
    }

    window.checkReviewSpelling = function(correctWord) {
      const input = document.getElementById('reviewSpellInput').value.trim().toLowerCase();
      const isCorrect = input === correctWord.toLowerCase();

      if (isCorrect) {
        showPraise();

        reviewIndex++;

        setTimeout(() => {
          continueReview();
        }, 1500);
      } else {
        showEncouragement();

        const gameContent = document.getElementById('unitGameContent');
        const correctAnswerDiv = document.createElement('div');
        correctAnswerDiv.style.cssText = 'text-align: center; margin-top: 16px; padding: 16px; background: #4ade80; color: white; border-radius: 12px; cursor: pointer; font-size: 20px; font-weight: bold;';
        correctAnswerDiv.textContent = `æ­£ç¡®ç­”æ¡ˆï¼š${correctWord}`;
        correctAnswerDiv.onclick = () => {
          reviewIndex++;
          continueReview();
        };
        gameContent.appendChild(correctAnswerDiv);

        document.getElementById('reviewSpellInput').disabled = true;
        document.getElementById('reviewSpellInput').style.border = '3px solid #f87171';
      }
    };

    // è®¡ç®—ç»“æœ
    function calculateResult() {
      const accuracy = (correctAnswers / totalQuestions) * 100;
      let rank = '';
      let storyTitle = '';
      let storyContent = '';
      let bgColor = '';
      let animationHTML = '';

      if (accuracy === 100) {
        rank = 'å®Œèƒœ';
        storyTitle = 'ä¼ å¥‡çš„è¯ç”Ÿ';
        storyContent = `
          <div style="text-align: left; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 16px; margin: 20px 0;">
            <p style="margin-bottom: 12px; line-height: 1.8;">âš”ï¸ åœ¨æœ€åä¸€å‡»ä¸­ï¼Œ${heroGender === 'male' ? 'è‹±å‹‡ç‹å­' : 'æ™ºæ…§å…¬ä¸»'}çš„å‰‘åˆƒé—ªè€€ç€é‡‘è‰²çš„å…‰èŠ’...</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ‰ æš—å½±é­”é¾™å‘å‡ºéœ‡å¤©çš„å’†å“®ï¼Œåºå¤§çš„èº«èº¯å¼€å§‹å´©è§£ï¼ŒåŒ–ä½œæ— æ•°é»‘è‰²çš„ç¢ç‰‡æ¶ˆæ•£åœ¨ç©ºä¸­ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">âœ¨ ç‹å›½çš„å¤©ç©ºé‡æ–°å˜å¾—æ˜äº®ï¼Œé˜³å…‰ç©¿é€äº†åƒå¹´çš„é˜´éœ¾ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ° äººä»¬ä»å››é¢å…«æ–¹èµ¶æ¥ï¼Œæ¬¢å‘¼ç€è‹±é›„çš„åå­—ã€‚å›½ç‹äº²è‡ªä¸ºä½ åŠ å†•ï¼Œæˆäºˆä½ ä¼ å¥‡å‹‡è€…çš„ç§°å·ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8; font-weight: bold; color: #f59e0b;">ğŸŠ ä½ çš„åå­—å°†è¢«æ°¸è¿œé“­åˆ»åœ¨ç‹å›½çš„å²å†Œä¸Šï¼</p>
          </div>
        `;
        bgColor = 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)';
        animationHTML = '<div style="font-size: 120px; animation: bounce 1s infinite;">ğŸ‘‘</div>';
        createConfetti();
        setTimeout(() => {
          createConfetti();
          createConfetti();
        }, 500);
      } else if (accuracy >= 90) {
        rank = 'æˆ˜èƒœ';
        storyTitle = 'è‹±é›„çš„å‡¯æ—‹';
        storyContent = `
          <div style="text-align: left; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 16px; margin: 20px 0;">
            <p style="margin-bottom: 12px; line-height: 1.8;">âš”ï¸ ç»è¿‡æ¿€çƒˆçš„æˆ˜æ–—ï¼Œä½ ç»ˆäºå‡»è´¥äº†æš—å½±é­”é¾™ï¼</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ‰ é­”é¾™åœ¨æœ€åçš„æŒ£æ‰ä¸­åŒ–ä½œé»‘çƒŸï¼Œæ¶ˆå¤±åœ¨åœ°å¹³çº¿ä¸Šã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸŒ… ç‹å›½æ¢å¤äº†å’Œå¹³ï¼Œäººä»¬è½½æ­Œè½½èˆåº†ç¥èƒœåˆ©ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ–ï¸ ä½ è¢«æˆäºˆå‹‡è€…ç§°å·ï¼Œæˆä¸ºç‹å›½çš„å®ˆæŠ¤è€…ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8; color: #10b981;">ğŸ’¡ å¦‚æœèƒ½æ›´åŠ ä¸“æ³¨ï¼Œä½ å°†æˆä¸ºä¼ å¥‡ï¼</p>
          </div>
        `;
        bgColor = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
        animationHTML = '<div style="font-size: 100px; animation: bounce 1s infinite;">ğŸ†</div>';
      } else if (accuracy >= 80) {
        rank = 'é™©èƒœ';
        storyTitle = 'æƒŠé™©çš„èƒœåˆ©';
        storyContent = `
          <div style="text-align: left; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 16px; margin: 20px 0;">
            <p style="margin-bottom: 12px; line-height: 1.8;">âš”ï¸ åœ¨åƒé’§ä¸€å‘ä¹‹é™…ï¼Œä½ å‡»ä¸­äº†é­”é¾™çš„è¦å®³ï¼</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ‰ æš—å½±é­”é¾™å—äº†é‡ä¼¤ï¼Œæš‚æ—¶é€€å›äº†é»‘æš—æ·±æ¸Šã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ˜° ä½†ä½ ä¹Ÿä»˜å‡ºäº†ä¸å°çš„ä»£ä»·ï¼Œè£…å¤‡å—æŸä¸¥é‡ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ° ç‹å›½æš‚æ—¶å®‰å…¨äº†ï¼Œä½†é­”é¾™å¯èƒ½ä¼šå·åœŸé‡æ¥ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8; color: #3b82f6;">ğŸ’ª ç»§ç»­ä¿®ç‚¼ï¼Œä¸‹æ¬¡ä¸€å®šèƒ½å®Œç¾å‡»è´¥å®ƒï¼</p>
          </div>
        `;
        bgColor = 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)';
        animationHTML = '<div style="font-size: 100px; animation: pulse 1.5s infinite;">âš”ï¸</div>';
      } else if (accuracy >= 70) {
        rank = 'æƒ¨èƒœ';
        storyTitle = 'è‰°éš¾çš„æˆ˜æ–—';
        storyContent = `
          <div style="text-align: left; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 16px; margin: 20px 0;">
            <p style="margin-bottom: 12px; line-height: 1.8;">âš”ï¸ æˆ˜æ–—å¼‚å¸¸æ¿€çƒˆï¼Œä½ å¤šæ¬¡é™©äº›è½è´¥ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ‰ æš—å½±é­”é¾™è™½ç„¶è¢«å‡»é€€ï¼Œä½†å¹¶æœªå—åˆ°è‡´å‘½ä¼¤å®³ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ˜“ ä½ çš„è£…å¤‡å‡ ä¹å…¨éƒ¨æŸæ¯ï¼Œä½“åŠ›ä¹Ÿæ¶ˆè€—æ®†å°½ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ° ç‹å›½è™½ç„¶ä¿ä½äº†ï¼Œä½†å±æœºå¹¶æœªè§£é™¤ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8; color: #8b5cf6;">ğŸ“š å›å»å¥½å¥½ä¿®ç‚¼ï¼Œæå‡å®åŠ›å†æ¥æŒ‘æˆ˜ï¼</p>
          </div>
        `;
        bgColor = 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)';
        animationHTML = '<div style="font-size: 100px; animation: pulse 1.5s infinite;">ğŸ›¡ï¸</div>';
      } else {
        rank = 'æˆ˜è´¥';
        storyTitle = 'é»‘æš—çš„é™ä¸´';
        storyContent = `
          <div style="text-align: left; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 16px; margin: 20px 0;">
            <p style="margin-bottom: 12px; line-height: 1.8;">âš”ï¸ æš—å½±é­”é¾™çš„åŠ›é‡è¿œè¶…ä½ çš„æƒ³è±¡...</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ‰ ä½ è¢«é­”é¾™çš„æ”»å‡»å‡»å€’ï¼Œå¤±å»äº†æˆ˜æ–—èƒ½åŠ›ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">ğŸ˜¢ ç‹å›½å†æ¬¡é™·å…¥é»‘æš—çš„ç»Ÿæ²»ä¹‹ä¸­ã€‚</p>
            <p style="margin-bottom: 12px; line-height: 1.8;">â° ä½†æ˜¯ï¼æ—¶å…‰é­”æ³•å¸ˆå‡ºç°äº†ï¼Œä»–æ„¿æ„å¸®åŠ©ä½ å›åˆ°è¿‡å»ï¼</p>
            <p style="margin-bottom: 12px; line-height: 1.8; color: #ef4444; font-weight: bold;">ğŸ”„ ä½¿ç”¨æ—¶å…‰é­”æ³•ï¼Œé‡æ–°æŒ‘æˆ˜æš—å½±é­”é¾™ï¼</p>
          </div>
        `;
        bgColor = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
        animationHTML = '<div style="font-size: 100px; animation: pulse 1.5s infinite;">â°</div>';
      }

      const gameContent = document.getElementById('unitGameContent');
      gameContent.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          ${animationHTML}
          <div style="background: ${bgColor}; color: white; padding: 16px 32px; border-radius: 20px; display: inline-block; margin-bottom: 24px;">
            <h2 style="font-size: 48px; margin: 0;">${rank}</h2>
          </div>
          <h3 style="font-size: 28px; color: #667eea; margin-bottom: 16px;">${storyTitle}</h3>
          ${storyContent}
          <div style="background: #f3f4f6; border-radius: 16px; padding: 24px; margin: 24px auto; max-width: 500px;">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; text-align: left;">
              <div>
                <div style="font-size: 14px; color: #666;">æ€»é¢˜æ•°</div>
                <div style="font-size: 24px; font-weight: bold; color: #667eea;">${totalQuestions}</div>
              </div>
              <div>
                <div style="font-size: 14px; color: #666;">ç­”å¯¹æ•°</div>
                <div style="font-size: 24px; font-weight: bold; color: #10b981;">${correctAnswers}</div>
              </div>
              <div>
                <div style="font-size: 14px; color: #666;">æ­£ç¡®ç‡</div>
                <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">${accuracy.toFixed(1)}%</div>
              </div>
              <div>
                <div style="font-size: 14px; color: #666;">æ€»å¾—åˆ†</div>
                <div style="font-size: 24px; font-weight: bold; color: #8b5cf6;">${gameScore}</div>
              </div>
            </div>
          </div>
          <div style="margin-top: 32px;">
            <div style="font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 16px;">ğŸ… è‹±é›„ç­‰çº§: ${heroLevel}</div>
            <div style="font-size: 16px; color: #10b981; margin-bottom: 8px;">âš”ï¸ å‡»è´¥é­”ç‰©: ${monstersDefeated} åª</div>
            <div style="font-size: 16px; color: #ef4444;">ğŸ‰ BOSSå‰©ä½™HP: ${bossHP}/10</div>
          </div>
          ${accuracy === 100 ? `
            <div style="margin-top: 32px; padding: 24px; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 16px; color: white; animation: pulse 2s infinite;">
              <div style="font-size: 32px; font-weight: bold; margin-bottom: 16px;">ğŸ ä¼ å¥‡å¥–åŠ±</div>
              <div style="font-size: 20px; margin-bottom: 8px;">ğŸ‘‘ è·å¾—ä¼ å¥‡ç§°å·ï¼š${heroGender === 'male' ? 'é¾™ä¹‹å¾æœè€…' : 'é¾™ä¹‹å¥³ç‹'}</div>
              <div style="font-size: 20px; margin-bottom: 8px;">ğŸ’ è·å¾—ç¥å™¨ï¼šæ°¸æ’ä¹‹å‰‘</div>
              <div style="font-size: 20px; margin-bottom: 8px;">ğŸŒŸ è§£é”æˆå°±ï¼šå®Œç¾æˆ˜å£«</div>
              <div style="font-size: 20px; margin-bottom: 8px;">ğŸ“œ ä½ çš„ä¼ å¥‡æ•…äº‹å°†è¢«æ°¸è¿œä¼ é¢‚</div>
              <div style="font-size: 24px; margin-top: 16px; font-weight: bold;">ğŸŠ æ­å–œä½ æˆä¸ºçœŸæ­£çš„è‹±é›„ï¼</div>
            </div>
          ` : ''}
          <div style="display: flex; gap: 12px; justify-content: center; margin-top: 32px; flex-wrap: wrap;">
            ${accuracy < 100 && accuracy >= 70 ? `
              <button class="btn btn-warning" onclick="startUnitLearning(${currentUnit})" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); animation: pulse 2s infinite;">
                ğŸ¯ æŒ‘æˆ˜å®Œç¾ç»“å±€
              </button>
            ` : ''}
            ${accuracy < 70 ? `
              <button class="btn btn-primary" onclick="startUnitLearning(${currentUnit})" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); animation: pulse 2s infinite;">
                â° ä½¿ç”¨æ—¶å…‰é­”æ³•é‡æ¥
              </button>
            ` : ''}
            <button class="btn btn-success" onclick="showUnitSelection()">ğŸ  è¿”å›å•å…ƒé€‰æ‹©</button>
            ${currentUnit < 3 && accuracy >= 70 ? `<button class="btn btn-primary" onclick="startUnitLearning(${currentUnit + 1})">â¡ï¸ ä¸‹ä¸€å•å…ƒ</button>` : ''}
          </div>
        </div>
      `;

      if (accuracy === 100) {
        playVictorySound();
        setTimeout(() => {
          playVictorySound();
          createConfetti();
          createConfetti();
          createConfetti();
        }, 500);
        setTimeout(() => {
          playVictorySound();
          createConfetti();
          createConfetti();
        }, 1000);
      }
    }

    // éŸ³æ•ˆå‡½æ•°
    function playEquipSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
      oscillator.type = 'sine';

      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    }

    function playUpgradeSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.setValueAtTime(659, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.1);
      oscillator.frequency.setValueAtTime(988, audioContext.currentTime + 0.2);
      oscillator.type = 'sine';

      gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.4);
    }

    function playAttackSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = 800;
      oscillator.type = 'square';

      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.2);
    }

    function playHitSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.value = 200;
      oscillator.type = 'sawtooth';

      gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    }

    function playVictorySound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
      oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
      oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
      oscillator.type = 'sine';

      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.4);
    }

    // è¯­éŸ³åˆæˆ
    function getBestVoice() {
      const voices = speechSynthesis.getVoices();
      const preferredVoices = [
        'Google US English',
        'Google UK English',
        'Microsoft Zira',
        'Microsoft Susan',
        'Samantha',
        'Karen'
      ];

      for (let preferred of preferredVoices) {
        const voice = voices.find(v => 
          v.name.includes(preferred) && 
          v.lang.startsWith('en') &&
          !v.localService
        );
        if (voice) return voice;
      }

      for (let preferred of preferredVoices) {
        const voice = voices.find(v => 
          v.name.includes(preferred) && 
          v.lang.startsWith('en')
        );
        if (voice) return voice;
      }

      return voices.find(v => v.lang.startsWith('en-US') || v.lang.startsWith('en-GB'));
    }

    window.speakWord = function(word) {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }

      const utterance = new SpeechSynthesisUtterance(word);
      const voice = getBestVoice();

      if (voice) {
        utterance.voice = voice;
        utterance.lang = voice.lang;
      } else {
        utterance.lang = 'en-US';
      }

      utterance.rate = 0.8;
      utterance.pitch = 1.0;
      utterance.volume = 1;

      speechSynthesis.speak(utterance);
    };

    // åé¦ˆåŠ¨ç”»
    function getRandomFeedback(pool, usedPool) {
      if (usedPool.length >= pool.length) {
        usedPool.length = 0;
      }

      const available = pool.filter((item, index) => !usedPool.includes(index));
      const randomIndex = Math.floor(Math.random() * available.length);
      const selected = available[randomIndex];

      const originalIndex = pool.indexOf(selected);
      usedPool.push(originalIndex);

      return selected;
    }

    function showEncouragement() {
      const feedback = getRandomFeedback(encouragements, usedEncouragements);
      const toast = document.createElement('div');
      toast.className = 'animation-toast encourage-toast';
      toast.innerHTML = `
        <span class="toast-icon">${feedback.icon}</span>
        <div>${feedback.text}</div>
      `;
      document.body.appendChild(toast);

      setTimeout(() => {
        document.body.removeChild(toast);
      }, 3000);
    }

    function showPraise() {
      const feedback = getRandomFeedback(praises, usedPraises);
      const toast = document.createElement('div');
      toast.className = 'animation-toast praise-toast';
      toast.innerHTML = `
        <span class="toast-icon">${feedback.icon}</span>
        <div>${feedback.text}</div>
      `;
      document.body.appendChild(toast);

      setTimeout(() => {
        document.body.removeChild(toast);
      }, 3000);
    }

    function showEasterEgg() {
      const feedback = getRandomFeedback(easterEggs, usedEasterEggs);
      const toast = document.createElement('div');
      toast.className = 'animation-toast easter-egg-toast';
      toast.innerHTML = `
        <span class="toast-icon">${feedback.icon}</span>
        <div>${feedback.text}</div>
      `;
      document.body.appendChild(toast);

      createConfetti();

      setTimeout(() => {
        document.body.removeChild(toast);
      }, 4000);
    }

    function createConfetti() {
      const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f7b731', '#5f27cd', '#00d2d3', '#ff9ff3', '#54a0ff'];
      const confettiCount = 50;

      for (let i = 0; i < confettiCount; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-10px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = Math.random() * 10 + 5 + 'px';
          confetti.style.height = confetti.style.width;
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          document.body.appendChild(confetti);

          setTimeout(() => {
            document.body.removeChild(confetti);
          }, 3000);
        }, i * 30);
      }
    }

    // äº‹ä»¶ç›‘å¬
    document.getElementById('backToUnitsBtn').addEventListener('click', () => {
      showUnitSelection();
    });

    // åˆå§‹åŒ–
    window.addEventListener('load', () => {
      speechSynthesis.getVoices();
      init();
    });

    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = () => {
        speechSynthesis.getVoices();
      };
    }
  </script>
</body>
</html>